<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/theme/light.css" id="theme">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous">

    <title>Samurai - ONERA - June 2024</title>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <div class="row">
            <div class="col-8">
              <img src="/figures/logo.png">
            </div>
            <div class="col-4 align-self-center text-end">
              <h1 class="title-talk">Samurai</h1>
              <p class="subtitle-talk">Scientific days - ONERA</p>
              <p class="mt-4 mb-0"><small>L. Fran√ßois, L. Gouarin and
                  M. Massot</small></p>
              <p class="mt-0"><small>19-20 June 2024</small></p>
            </div>
          </div>
          <div>
            <img width="60px" src="/figures/by.png" />
            <span style="font-size: 10px">This work is licensed under a Creative
              Commons Attribution 4.0 International License</span>
          </div>
        </section>

        <section data-menu-title="Context">
          <section>
            <h1>Context</h1>
            <hr>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Mesh adaptation</h1>
              </div>
              <div class="main">
                <div class="row">
                  <div class="col">
                    <img id="adapt" src="/light/figures/patch_based.png">
                  </div>
                  <div class="col">
                    <img id="adapt" src="/light/figures/cell_based.png">
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <!-- <h1 class="title">AMR characteristics</h1> -->
              </div>
              <div class="main text-center">
                <img width="80%" id="adapt" src="/light/figures/amr-charac.png">
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Open source software</h1>
              </div>
              <div class="main text-center">
                <table style="font-size: 20px;">
                  <tr>
                    <th class="text-center">Name</th>
                    <th class="text-center">Data structure</th>
                    <th class="text-center">Adaptation criteria</th>
                    <th class="text-center">Time scheme</th>
                    <th class="text-center">Load balancing</th>
                  </tr>
                  <tr>
                    <td class="text-center">AMReX</td>
                    <td class="text-center">block</td>
                    <td class="text-center">heuristic</td>
                    <td class="text-center">global/local</td>
                    <td class="text-center">SFC</td>
                  </tr>
                  <tr>
                    <td class="text-center">Dendro</td>
                    <td class="text-center">tree</td>
                    <td class="text-center">wavelet</td>
                    <td class="text-center">global</td>
                    <td class="text-center">SFC</td>
                  </tr>
                  <tr>
                    <td class="text-center">Dyablo</td>
                    <td class="text-center">tree</td>
                    <td class="text-center">heuristic</td>
                    <td class="text-center">global</td>
                    <td class="text-center">SFC</td>
                  </tr>
                  <tr>
                    <td class="text-center">Peano</td>
                    <td class="text-center">tree</td>
                    <td class="text-center">-</td>
                    <td class="text-center">-</td>
                    <td class="text-center">SFC</td>
                  </tr>
                  <tr>
                    <td class="text-center">P4est</td>
                    <td class="text-center">tree</td>
                    <td class="text-center">-</td>
                    <td class="text-center">-</td>
                    <td class="text-center">SFC</td>
                  </tr>
                  <tr>
                    <td class="text-center">samurai</td>
                    <td class="text-center">interval</td>
                    <td class="text-center">heuristic/wavelet</td>
                    <td
                      class="text-center"><p
                        class="mb-0"><span>RK/splitting/IMEX</span></p>
                      <p class="mt-0"><span>time-space/code
                          coupling</span></p></td>
                    <td class="text-center"><span>SFC/
                        diffusion algorithm</span></td>
                  </tr>
                </table>

                <div class="pt-5 fragment">
                  <i class="text-center"><span>samurai: create a unified
                      framework for testing a whole range of mesh
                      adaptation methods with the latest generation of numerical
                      schemes.</span></i>
                </div>
              </div>
            </div>
          </section>
        </section>

        <section data-menu-title="Context">
          <section>
            <h1>Samurai</h1>
            <hr>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Design principles</h1>
              </div>
              <div class="main">
                <ul>
                  <li>Mesh compression according to the level</li>
                  <li>Achieve fast look-up for a cell into the structure</li>
                  <li>Maximize the memory contiguity of the stored data</li>
                  <li>Facilitate inter-level operations</li>
                  <li>Give the possibility of writing numerical schemes
                    easily</li>
                </ul>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">An overview of the data structure</h1>
              </div>
              <div class="main">
                <div class="row">
                  <div class="col-5 align-self-center">
                    <img src="figures/2d_example.png">
                  </div>
                  <div class="col-7 text-center align-self-center">
                    <span class="interval_symb">[</span>
                    <span class="interval_bound">start</span>
                    <span class="interval_symb">,</span>
                    <span class="interval_bound">end</span>
                    <span class="interval_symb">[ @ </span>
                    <span class="interval_offset">offset</span>
                    <span class="interval_symb">:</span>
                    <span class="interval_step">step</span>

                  </div>
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">An overview of the data structure</h1>
              </div>
              <div class="main">
                <div class="row">
                  <div class="col-4 align-self-center">
                    <img src="figures/2d_example.png">
                  </div>
                  <div
                    class="col-3 fragment align-self-center border border-2 p-2"
                    data-fragment-index="1">
                    <ul class="myclass">
                      <li class="color_0"><strong>Level 0</strong></li>
                      <ul>
                        <li>y: 0 <span>&#8594;</span> [0, 4[</li>
                        <li>y: 1 <span>&#8594;</span> [0, 1[, [3, 4[</li>
                        <li>y: 2 <span>&#8594;</span> [0, 1[, [3, 4[</li>
                        <li>y: 3 <span>&#8594;</span> [0, 3[</li>
                      </ul>

                      <li class="color_1"><strong>Level 1</strong></li>
                      <ul>
                        <li>y: 2 <span>&#8594;</span> [2, 6[</li>
                        <li>y: 3 <span>&#8594;</span> [2, 6[</li>
                        <li>y: 4 <span>&#8594;</span> [2, 4[, [5, 6[</li>
                        <li>y: 5 <span>&#8594;</span> [2, 6[</li>
                        <li>y: 6 <span>&#8594;</span> [6, 8[</li>
                        <li>y: 7 <span>&#8594;</span> [6, 7[</li>
                      </ul>

                      <li class="color_2"><strong>Level 2</strong></li>
                      <ul>
                        <li>y: 8 <span>&#8594;</span> [8, 10[</li>
                        <li>y: 9 <span>&#8594;</span> [8, 10[</li>
                        <li>y: 14 <span>&#8594;</span> [14, 16[</li>
                        <li>y: 15 <span>&#8594;</span> [14, 16[</li>
                      </ul>
                    </ul>
                    <div class="text-center fragment" data-fragment-index="4">
                      <span class="caveat">cell list</span>
                    </div>
                  </div>
                  <div
                    class="col-4 fragment  align-self-center border border-2 m-2 p-2"
                    data-fragment-index="2">

                    <ul class="myclass">
                      <li class="color_0"><strong>Level 0</strong></li>
                      <ul>
                        <li>x: [0, 4[, [0, 1[, [3, 4[, [0, 1[, [3, 4[, [0,
                          3[</li>
                        <li>y: [0, 4[ <span class="fragment"
                            data-fragment-index="3">@0</span></li>
                        <li>y-offset: [0, 1, 3, 5, 6]</li>
                      </ul>
                      <li class="color_1"><strong>Level 1</strong></li>
                      <ul>
                        <li>x: [2, 6[, [2, 6[, [2, 4[, [5, 6[, [2, 6[, [6, 8[,
                          [6, 7[</li>
                        <li>y: [2, 8[<span class="fragment"
                            data-fragment-index="3">@-2</span></li>
                        <li>y-offset = [0, 1, 2, 4, 5, 6, 7]</li>
                      </ul>
                      <li class="color_2"><strong>Level 2</strong></li>
                      <ul>
                        <li>x: [8, 10[, [8, 10[, [14, 16[, [14, 16[</li>
                        <li>y: [8, 10[<span class="fragment"
                            data-fragment-index="3">@-8</span>, [14, 16[<span
                            class="fragment"
                            data-fragment-index="3">@-12</span></li>
                        <li>y-offset: [0, 1, 2, 3, 4]</li>
                      </ul>
                    </ul>
                    <div class="text-center fragment" data-fragment-index="4">
                      <span class="caveat">cell array</span>
                    </div>

                  </div>
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">An overview of the data structure</h1>
              </div>
              <div class="main">
                <div class="row">
                  <div class="col-5 align-self-center">
                    <img src="figures/2d_example_numbering.png">
                  </div>
                  <div class="col align-self-center border border-2 p-2">
                    <ul class="myclass">
                      <li class="color_0"><strong>Level 0</strong></li>
                      <ul>
                        <li>x: [0, 4[ <span>@ 0</span>, [0, 1[ <span>@ 4</span>,
                          [3, 4[ <span>@ 2</span>, [0, 1[ <span>@ 6</span>,
                          [3,
                          4[ <span>@ 4</span>, [0, 3[ <span>@ 4</span></li>
                        <li>y: [0, 4[ <span>@ 0</span></li>
                        <li>y-offset: [0, 1, 3, 5, 6]</li>
                      </ul>

                      <li class="color_1"><strong>Level 1</strong></li>
                      <ul>
                        <li>x: [2, 6[ <span>@ 9</span>, [2, 6[ <span>@
                            13</span>,
                          [2, 4[ <span>@ 17</span>, [5, 6[ <span>@ 16</span>,
                          [2, 6[ <span>@ 20</span>, [6, 8[ <span>@ 20</span>,
                          [6, 7[ <span>@ 22</span></li>
                        <li>y: [2, 8[ <span>@ -2</span></li>
                        <li>y-offset : [0, 1, 2, 4, 5, 6, 7]</li>
                      </ul>

                      <li class="color_2"><strong>Level 2</strong></li>
                      <ul>
                        <li>x: [8, 10[ <span>@ 21</span>, [8, 10[ <span>@
                            23</span>,
                          [14, 16[ <span>@ 19</span>, [14, 16[ <span>@
                            21</span></li>
                        <li>y: [8, 10[ <span>@ -8</span>, [14, 16[ <span>@
                            -12</span></li>
                        <li>y-offset: [0, 1, 2, 3, 4]</li>
                      </ul>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Mesh constraints</h1>
              </div>
              <div class="main">
                <ul>
                  <li>A refined cell is split into 2 in 1d, 4
                    in 2d and 8 in 3d equal parts.</li>
                  <li>At a given resolution level, the size of
                    the cells is equal.</li>
                  <li>The size of the cells is defined by the
                    resolution level.</li>
                  $$\Delta x = 2^{-level}$$
                  <li>A cell is represented by integer
                    coordinates given its location.</li>
                  $$center = \Delta x (indices + 0.5)$$
                  <li>The adapted mesh is generally graded.</li>
                </ul>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Identify the different types of cells</h1>
              </div>
              <div class="main text-center">
                <video id="adapt" data-autoplay
                  src="/light/videos/identify_0000.mp4" />
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Identify the different types of cells</h1>
              </div>
              <div class="main text-center">
                <video id="adapt" data-autoplay
                  src="/light/videos/identify_0001.mp4" />
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Identify the different types of cells</h1>
              </div>
              <div class="main text-center">
                <video id="adapt" data-autoplay
                  src="/light/videos/identify_0002.mp4" />
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Identify the different types of cells</h1>
              </div>
              <div class="main text-center">
                <video id="adapt" data-autoplay
                  src="/light/videos/identify_0003.mp4" />
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Algebra of sets</h1>
              </div>
              <div class="main text-center">
                <div>
                  <img class="border border-2" width="400px" data-autoplay
                    src="/figures/mesh.png" />
                  <span>&#8899;</span>
                  <img class="border border-2" width="400px" data-autoplay
                    src="/figures/mesh_ghost.png" />
                </div>
                <span>=</span>
                <div>
                  <img class="border border-2" width="400px" data-autoplay
                    src="/figures/mesh_all.png" />
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Algebra of sets</h1>
              </div>
              <div class="main text-center">
                <div>
                  <img class="border border-2" width="400px" data-autoplay
                    src="/figures/mesh_all.png" />
                  <span>\</span>
                  <img class="border border-2" width="400px" data-autoplay
                    src="/figures/mesh.png" />
                </div>
                <span>=</span>
                <div>
                  <img class="border border-2" width="400px" data-autoplay
                    src="/figures/mesh_ghost.png" />
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Algebra of sets</h1>
              </div>
              <div class="main">
                <p>The search of an admissible set is recursive. The
                  algorithm starts from the last dimension (y in 2d, z in 3d,
                  ‚Ä¶).</p>

                <p>The available operators in samurai are for now</p>
                <ul>
                  <li>the <span>intersection</span> of sets,</li>
                  <li>the <span>union</span> of sets,</li>
                  <li>the <span>difference</span> between two sets,</li>
                  <li>the <span>translation</span> of a set,</li>
                  <li>the <span>extension</span> of a set.</li>
                </ul>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Compression rates</h1>
              </div>
              <div class="main text-center">
                <img src="figures/p4est_3.png">
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Compression rates</h1>
              </div>
              <div class="main">
                <table>
                  <tr>
                    <th>Level</th>
                    <th>Num. of cells</th>
                    <th>p4est</th>
                    <th>samurai (leaves)</th>
                    <th>samurai (all)</th>
                    <th>ratio</th>
                  </tr>
                  <tr>
                    <td>9</td>
                    <td>$66379$</td>
                    <td>$2.57$ Mb</td>
                    <td>$33.68$ Kb</td>
                    <td>$121$ Kb</td>
                    <td>$21.24$</td>
                  </tr>
                  <tr>
                    <td>10</td>
                    <td>$263767$</td>
                    <td>$10.25$ Mb</td>
                    <td>$66.64$ Kb</td>
                    <td>$236.8$ Kb</td>
                    <td>$43.28$</td>
                  </tr>
                  <tr>
                    <td>11</td>
                    <td>$1051747$</td>
                    <td>$40.96$ Mb</td>
                    <td>$132.36$ Kb</td>
                    <td>$467.24$ Kb</td>
                    <td>$87.66$</td>
                  </tr>
                  <tr>
                    <td>12</td>
                    <td>$4200559$</td>
                    <td>$163.75$ Mb</td>
                    <td>$263.6$ Kb</td>
                    <td>$927$ Kb</td>
                    <td>$176.64$</td>
                  </tr>
                  <tr>
                    <td>13</td>
                    <td>$16789627$</td>
                    <td>$654.86$ Mb</td>
                    <td>$525.9$ Kb</td>
                    <td>$1.85$ Mb</td>
                    <td>$353.98$</td>
                  </tr>
                  <tr>
                    <td>14</td>
                    <td>$67133575$</td>
                    <td>$2.61$ Gb</td>
                    <td>$1.05$ Mb</td>
                    <td>$3.68$ Mb</td>
                    <td>$709.24$</td>
                  </tr>
                </table>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Other features</h1>
              </div>
              <div class="main">
                <ul>
                  <li>Loop algorithms over the levels and the cells</li>
                  <li>Simplified access operator</li>
                  <li>Helper classes to construct complex meshes</li>
                  <li>Helper classes to construct schemes for explicit and
                    implicit usage</li>
                  <li>Helper classes to construct N-D operators and expressions
                    using xtensor</li>
                  <li>HDF5 support</li>
                </ul>
              </div>
            </div>
          </section>
        </section>

        <section data-menu-title="examples">
          <section>
            <h1>Examples</h1>
            <hr>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Field creation</h1>
              </div>
              <div class="main">
                <pre><code class="cpp data-trim data-noescape">auto mesh = samurai::MRMesh&lt;Config&gt;({{0, 0}, {1, 1}}, 2, 8);
auto u = samurai::make_field&lt;double, 1&gt;("u", mesh);

samurai::for_each_cell(mesh, [&](auto cell)
{
  auto x = cell.center(0);
  auto y = cell.center(1);

  u[cell] = x*x + y*y;
});
                </code></pre>
              </div>
            </div>
          </section>

          <section>
            <h1>The projection operator</h1>
            <hr>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">An example</h1>
              </div>
              <div class="main">
                <video id="adapt" data-autoplay
                  src="/light/videos/projection.mp4" />
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">The implementation</h1>
              </div>
              <div class="main">
                <pre><code class="cpp data-trim data-noescape" data-line-numbers="1|2-4|6-9">auto u = samurai::make_field&lt;double, 1&gt;("u", mesh);
...
auto set = samurai::intersection(mesh[level], mesh[level + 1])
          .on(level);

set([&](const auto& i, auto)
{
    u(level, i) = 0.5*(u(level + 1, 2*i) + u(level + 1, 2*i + 1));
});
                </code></pre>
              </div>
            </div>
          </section>

          <section>
            <h2>Creation of random meshes and their graduation</h2>
            <hr>
          </section>

          <section>
            <div class="row">
              <div class="col-6">
                <img src="/figures/graduation_before.png" />
                before
              </div>
              <div class="col-6">
                <img src="/figures/graduation_after.png" />
                after
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Create a mesh</h1>
              </div>
              <div class="main">
                <pre><code class="cpp">
constexpr std::size_t dim = 2;
std::size_t start_level = 1;
std::size_t max_refinement_level = 7;

samurai::Box&lt;int, dim&gt; box({0, 0}, {1&lt;&lt;start_level, 1&lt;&lt;start_level});

samurai::CellArray&lt;dim&gt; ca;
ca[start_level] = {start_level, box};
                  </code></pre>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Add cells randomly</h1>
              </div>
              <div class="main">
                <pre><code class="cpp">samurai::CellList&lt;dim&gt; cl;

samurai::for_each_interval(ca, [&](std::size_t level, const auto& interval, const auto& index)
{
    auto choice = xt::random::choice(xt::xtensor_fixed&lt;bool,
                                     xt::xshape&lt;2&gt;&gt;{true, false}, interval.size());

    for(int i = interval.start, ic = 0; i&lt;interval.end; ++i, ++ic)
    {
        if (choice[ic])
        {
            cl[level + 1][2*index].add_interval({2*i, 2*i+2});
            cl[level + 1][2*index + 1].add_interval({2*i, 2*i+2});
        }
        else
        {
            cl[level][index].add_point(i);
        }
    }
});

ca = {cl, true};
                  </code></pre>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Tag cells to refine</h1>
              </div>
              <div class="main">
                <pre><code class="cpp">std::size_t min_level = ca.min_level(), max_level = ca.max_level();
xt::xtensor_fixed&lt;int, xt::xshape&lt;4, dim&gt;&gt; stencil{{1, 0}, {-1, 0}, {0, 1}, {0, -1}};

auto tag = samurai::make_field&lt;bool, 1&gt;("tag", ca);
tag.fill(false);

for(std::size_t level = min_level + 2; level &lt;= max_level; ++level)
{
    for(std::size_t level_below = min_level; level_below &lt; level - 1; ++level_below)
    {
        for(std::size_t i = 0; i &lt; stencil.shape()[0]; ++i)
        {
            auto s = xt::view(stencil, i);
            auto set = samurai::intersection(samurai::translate(ca[level], s), ca[level_below])
                      .on(level_below);
            set([&](const auto& i, const auto& index)
            {
                tag(level_below, i, index[0]) = true;
            });
        }
    }
}
                  </code></pre>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Create a new mesh from the tag</h1>
              </div>
              <div class="main">
                <pre><code class="cpp">
samurai::CellList&lt;dim&gt; cl;

samurai::for_each_cell(ca, [&](auto cell)
{
    auto i = cell.indices[0];
    auto j = cell.indices[1];

    if (tag[cell])
    {
        cl[cell.level + 1][{2*j}].add_interval({2*i, 2*i+2});
        cl[cell.level + 1][{2*j + 1}].add_interval({2*i, 2*i+2});
    }
    else
    {
        cl[cell.level][{j}].add_point(i);
    }
});

samurai::CellArray&lt;dim&gt; new_ca = {cl, true};
                  </code></pre>
              </div>
            </div>
          </section>

          <section>
            <h1>The heat equation</h1>
            <hr>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">The problem</h1>
              </div>
              <div class="main">
                We consider the well known heat equation
                $$
                \frac{\partial u}{\partial t} - \Delta u =
                0
                $$
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">The finite volume scheme</h1>
              </div>
              <div class="main">
                Since we have

                $$
                \int_V \Delta u = \int_{\partial V} \nabla u\cdot \mathbf{n},
                $$

                the flux function to implement is a discrete version of
                $\nabla
                u\cdot \mathbf{n}$.
                Here, we choose the normal gradient of the first order,
                requiring a stencil of two cells.
                This is enough to write the static configuration

                <pre><code class="cpp data-trim data-noescape">auto u = samurai::make_field&lt;1&gt;("u", mesh); // scalar field

using cfg = samurai::FluxConfig&lt;SchemeType::LinearHomogeneous,
                                1,            // output_field_size
                                2,            // stencil_size
                                decltype(u)>; // input_field_type
                </code></pre>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">The finite volume scheme</h1>
              </div>
              <div class="main">

                Now, denoting by $V_L$ (left) and $V_R$ (right) the stencil
                cells and $F$ their interface, the discrete flux from $V_L$ to
                $V_R$ writes

                $$
                \mathcal{F}_h(u_h)_{|F} := \frac{u_R-u_L}{h},
                $$
                where $u_L$ and $u_R$ are the finite volume approximations of
                $u$ in the respective cells, and $h$ is the cell length.

                The flux function then writes

                <pre><code class="cpp data-trim data-noescape">samurai::FluxDefinition&lt;cfg&gt; gradient([](double h)
{
    samurai::FluxStencilCoeffs&lt;cfg&gt; c;
    c[0] = -1/h; // left
    c[1] =  1/h; // right
    return c;
});

auto diff = samurai::make_flux_based_scheme(gradient);
          </code></pre>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Simulation on uniform mesh</h1>
              </div>
              <div class="main">
                <pre><code class="cpp">...
auto diff = samurai::make_diffusion&lt;decltype(u)>();
auto id   = samurai::make_identity&lt;decltype(u)>();
for(std::size_t ite=0; ite&lt;200; ++ite)
{
    samurai::update_ghost_mr(u);

    if (explicit_scheme)
    {
        unp1 = u - dt * diff(u);
    }
    else
    {
        auto back_euler = id + dt * diff;
        // solves the linear equation   [Id + dt*Diff](unp1) = u
        samurai::petsc::solve(back_euler, unp1, u);
    }

    std::swap(u.array(), u_np1.array());

    samurai::save(fmt::format("mesh_{}", ite + 1), mesh, u);
}

                </code></pre>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Simulation with adaptive mesh
                  refinement</h1>
              </div>
              <div class="main">
                <pre><code class="cpp" data-line-numbers="1-2,6-7">auto MRadaptation = samurai::make_MRAdapt(u);
double eps = 1e-4, regularity = 2;

for(std::size_t ite=0; ite&lt;200; ++ite)
{
    MRadaptation(eps, regularity);
    unp1.resize();
    samurai::update_ghost_mr(u);

    if (explicit_scheme)
    {
        unp1 = u - dt * diff(u);
    }
    else
    {
      auto back_euler = id + dt * diff;
      // solves the linear equation   [Id + dt*Diff](unp1) = u
      samurai::petsc::solve(back_euler, unp1, u);
    }

    std::swap(u.array(), u_np1.array());
    samurai::save(fmt::format("mesh_{}", ite + 1), mesh, u);
}
              </code></pre>
              </div>
            </div>
          </section>

          <section>
            <h2>A dual Splitting/IMEX strategy for stiff
              PDEs</h2>
            <hr>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">A dual Splitting/IMEX strategy for stiff
                  PDEs</h1>
              </div>
              <div class="main">
                <div class="row align-items-center" style="font-size: 15px">
                  <div class="col-7">
                    <ul>
                      <li class="my-1">A strategy has been designed (PhD M.
                        Duarte) relying
                        on
                        time-adaptive operator splitting with dynamically
                        adapted
                        mesh (multiresolution) with error control:</li>
                      <ul class="mx-5 px-0">
                        <li>optimal computational cost and parallelization
                          properties
                          when large splitting time steps compared to the
                          smallest
                          time scale can be taken without impairing
                          precision</li>
                      </ul>
                      <li class="mt-3 mb-1">We aim at resolving stiff PDEs with
                        samurai and ponio
                        (time
                        integrators) libraries with the same computation
                        favorable
                        properties</li>
                      <ul class="mx-5 px-0">
                        <li class="my-1">the same computational properties
                          (local
                          implicitation
                          of the source term - allowing for very stiff source
                          with
                          local time integration in space)</li>
                        <li class="my-1">explicit diffusion integration without
                          von Neumann
                          stability
                          limit (ROCK)</li>
                        <li class="my-1">high-order in space and time
                          integration of
                          convection,
                          including shocks</li>
                        <li class="my-1">strong acceleration through adaptation
                          in space and
                          time</li>
                      </ul>
                      <li class="mt-3">Stumbling block : what to do when
                        reaction and
                        diffusion
                        coupled to the smallest time scale (complex
                        chemistry)</li>
                    </ul>
                  </div>
                  <div class="col-5">
                    <div>
                      <video data-autoplay loop="true"
                        src="./figures/ignition_Re1000.mov" />
                    </div>
                    <div>
                      <img src="./figures/splitting_time_steps.jpg">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">A dual Splitting/IMEX strategy for stiff
                  PDEs</h1>
              </div>
              <div class="main">
                <div class="row align-items-center">
                  <div class="col-8">
                    <ul>
                      <li>Keep reaction and diffusion coupled (IMEX) !</li>
                      <li>No splitting time step limitation due to the coupling
                        at
                        small scale (complex chemistry and detailed transport in
                        flames for example)</li>
                      <li>Relying on the PIROCK strategy of G. Vilmart and A.
                        Abdulle.</li>
                      <li>Adaptation in space and time with error control</li>
                      <li>Project with CEA on hydrogen risk - DNS combustion
                        with
                        detailed transport and CChem</li>
                    </ul>
                  </div>
                  <div class="col-4 text-center">
                    <div>
                      <img id="adapt" width="50%"
                        src="/light/figures/hpc@maths.png">
                    </div>
                    <div>
                      <img width="50%" src="./figures/logo.png">
                    </div>
                    <div>
                      <img width="50%" src="./figures/logo-cea.webp">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">A dual Splitting/IMEX strategy for stiff
                  PDEs</h1>
              </div>
              <div class="main">
                <div class="row align-items-center" style="font-size: 16px;">
                  <div class="col-6">
                    <p>Ignition and Combustion (Verwer & Hundsdorfer)</p>
                    <p>Specific for RKC methods and ROCK</p>
                    $$
                    u_t = d \Delta u + \frac{R}{\alpha \delta} (1 + \alpha -
                    u)
                    e^{\delta( 1 - 1/u )} \quad \text{in }
                    [0,1]\times[0,1]\\
                    $$
                    <div class="text-center">
                      <img width="60%" class="text-center"
                        src="/figures/combustion2d.png">
                    </div>
                  </div>
                  <div class="col-6 text-center">
                    <img width="80%" src="/figures/combustion.svg">
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">A dual Splitting/IMEX strategy for stiff
                  PDEs</h1>
              </div>
              <div class="main">
                <div class="row align-items-center" style="font-size: 16px;">
                  <div class="col-6">
                    <p>Ignition and Combustion (Verwer & Hundsdorfer)</p>
                    <p>Specific for RKC methods and ROCK</p>
                    $$
                    u_t = d \Delta u + \frac{R}{\alpha \delta} (1 + \alpha -
                    u)
                    e^{\delta( 1 - 1/u )} \quad \text{in }
                    [0,1]\times[0,1]\\
                    $$
                    <div class="text-center">
                      <img width="60%" class="text-center"
                        src="/figures/combustion2d.png">
                    </div>
                  </div>
                  <div class="col-6 text-center  fragment">

                    <section data-markdown style="font-size: 12px;">
                      | | PIROCK | ROCK2 | ROCK4 |
                      |------------------------------------|-------------|------------|-----------|
                      |Tolerance used | 1e-5 | 1e-6 | 1e-5 |
                      |L2 norm of error | 1.84e-4 | 2.27e-4 | 2.69e-4 |
                      |Elapsed time (s) | 7.97 | 1.90 | 0.42 |
                      |Nb. time steps. | 889 | 157 | 57 |
                      |Nb. time steps rejected | 0 | 0 | 0 |
                      |Nb. function evaluation | - | 6367 | 1734 |
                      |Nb. function evaluation (diffusion) | 8304 | - | - |
                      |Nb. function evaluation (reaction) | 360067655 | - | -
                      |
                    </section>
                    <p class="mt-0"><small> between $t=0.29$ and
                        $t=0.32$.</small></p>
                    <div class="fragment">
                      <div class="border border-2">
                        <p>IMEX reasonable overhead compared to fully explicit
                          methods (ROCK2 - ROCK4) even in this very difficult
                          configuration</p>
                        <ul class="list-unstyled text-center">
                          <li class="my-1">Error control</li>
                          <li class="my-1">Good BC treatment</li>
                          <li class="my-1">No splitting errors</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">A dual Splitting/IMEX strategy for stiff
                  PDEs</h1>
              </div>
              <div class="main">
                <div class="row align-items-center">
                  <div class="col-6" style="font-size: 14px">
                    Belousov-Zhabotinsky (very stiff source - 3 eq)
                    $$
                    \left\{
                    \begin{aligned}
                    \partial_t a - D_a \, \Delta a &= \frac{1}{\mu} ( -qa - ab
                    +
                    fc) \\
                    \partial_t b - D_b \, \Delta b &= \frac{1}{\varepsilon} (
                    qa
                    - ab + b\,(1-b)) \\
                    \partial_t c - D_c \, \Delta c &= b - c
                    \end{aligned}
                    \right.
                    $$
                    <ul class="px-0">

                      <li>Error to the reference quasi-exact solution is
                        second
                        order in time but not of the same origin (splitting
                        error
                        vs. IMEX error) - but still error control</li>
                      <li>Larger time step can be taken with IMEX while
                        keeping
                        a
                        proper solution (no disastrous splitting errors -
                        wrong
                        wave speed)</li>
                      <li>When optimal large splitting time step is taken,
                        IMEX
                        as
                        efficient as splitting, whereas it is advantageous for
                        smaller time steps as well as larger time steps</li>
                      <li>No boundary condition problems</li>
                      <li>Same computational good properties</li>

                    </ul>
                  </div>
                  <div class="col-6 text-center">
                    <img width="48%" class="my-0" src="/figures/bz_b_t=0.png">
                    <img width="48%" class="my-0" src="/figures/bz_b_t=1.png">
                    <br>
                    <img width="48%" class="my-0" src="/figures/bz_b_t=2.png">
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">A dual Splitting/IMEX strategy for stiff
                  PDEs</h1>
              </div>
              <div class="main">
                <div class="row align-items-center">
                  <div class="col-6" style="font-size: 14px">
                    Belousov-Zhabotinsky (very stiff source - 3 eq)
                    $$
                    \left\{
                    \begin{aligned}
                    \partial_t a - D_a \, \Delta a &= \frac{1}{\mu} ( -qa - ab
                    +
                    fc) \\
                    \partial_t b - D_b \, \Delta b &= \frac{1}{\varepsilon} (
                    qa
                    - ab + b\,(1-b)) \\
                    \partial_t c - D_c \, \Delta c &= b - c
                    \end{aligned}
                    \right.
                    $$
                    <ul class="px-0">

                      <li>Error to the reference quasi-exact solution is
                        second
                        order in time but not of the same origin (splitting
                        error
                        vs. IMEX error) - but still error control</li>
                      <li>Larger time step can be taken with IMEX while
                        keeping
                        a
                        proper solution (no disastrous splitting errors -
                        wrong
                        wave speed)</li>
                      <li>When optimal large splitting time step is taken,
                        IMEX
                        as
                        efficient as splitting, whereas it is advantageous for
                        smaller time steps as well as larger time steps</li>
                      <li>No boundary condition problems</li>
                      <li>Same computational good properties</li>

                    </ul>
                  </div>
                  <div class="col-6 text-center">
                    <div>
                      <section data-markdown style="font-size: 12px;">
                        | | PIROCK (tol=5e-3) | STRANG (dt=2/128) |
                        |------------------------------|:------------------:|:--------------------:|
                        |L2 norm of error (variable b) | 3.31e-2 | 1.14e-1 |
                        |L2 norm of error (variable c) | 2.92e-3 | 1.37e-2 |
                        |Elapsed time (s) | 6.91 | 6.70 |
                        |Nb. time steps. | 624 | 128 |

                        &nbsp;

                        | | PIROCK (tol=1e-3) | STRANG (dt=2/512) |
                        |------------------------------|:------------------:|:--------------------:|
                        |L2 norm of error (variable b) | 4.94e-3 | 1.55e-3 |
                        |L2 norm of error (variable c) | 4.31e-4 | 1.41e-4 |
                        |Elapsed time (s) | 13.33 | 17.20 |
                        |Nb. time steps. | 1528 | 512 |

                        &nbsp;

                        | | PIROCK (tol=1e-4) | STRANG (dt=2/16384) |
                        |------------------------------|:------------------:|:--------------------:|
                        |L2 norm of error (variable b) | 7.72e-6 | 1.81e-5 |
                        |L2 norm of error (variable c) | 6.97e-7 | 1.57e-6 |
                        |Elapsed time (s) | 165.12 | 427.81 |
                        |Nb. time steps. | 31728 | 16384 |
                      </section>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section>
            <div class="sl-block">
              <div class="header">
                <h1 class="title">Key point</h1>
              </div>
              <div class="main text-center">
                <p>
                  Implement your finite volume scheme on a uniform cartesian
                  grid
                </p>
                <p>and</p>

                <p><span>you have explicit and implicit
                    at your disposal</span></p>
                <p><span>you have a large range of time
                    schemes
                    available</span></p>
                <p><span>you have the adaptation (MRA / AMR)
                    without further effort
                  </span></p>
                <p><span>you have parallelism</span></p>
              </div>
            </div>
          </section>
        </section>

        <section>
          <div class="sl-block">
            <div class="header">
              <h1 class="title">HPC@Maths</h1>
            </div>
            <div class="main" style="font-size: 20px">
              <p>samurai is part of the projects developed in the HPC@Maths
                team (5 permanent researchers, 5 research engineers, 1
                project
                manager, 11
                research
                associates, 6 PhD students, 1 Post-doc).</p>

              <p>The main goals of this team are</p>
              <img id="adapt" src="/light/figures/actions.png">
              <div class="text-center">
                <p>PI: Lo√Øc Gouarin and Marc Massot -
                  <a
                    href="https://initiative-hpc-maths.gitlab.labos.polytechnique.fr/site/index.html">HPC@Maths
                    website</a></p>
              </div>
            </div>
          </div>
        </section>

        <section>
          <div class="sl-block">
            <div class="header">
              <h1 class="title">Scientific collaborations</h1>
            </div>
            <div class="main" style="font-size: 18px">
              <ul>
                <li><span>Lattice Boltzmann methods and
                    multiresolution</span>
                  -
                  <strong>Thomas
                    Bellotti</strong> (IRMA/Universit√© Strasbourg) and
                  <strong>Benjamin Graille</strong> (LMO/Universit√©
                  Paris-Saclay)</li>
                <li><span>Plasma discharges and electric propulsion</span> -
                  <strong>Alejandro Alvarez</strong> (LPP/Ecole
                  polytechnique) and <strong>Louis
                    Reboul</strong> (ONERA)</li>
                <li><span>Direct numerical simulation of lithium-ion
                    batteries
                    based
                    on high-resolution 3D images of porous electrode
                    microstructures</span> - <strong>Ali Asad</strong>
                  (TotalEnergies) and <strong>Laurent Fran√ßois</strong>
                  (ONERA)</li>
                <li><span>Sharp interface method for low Mach two-phase
                    flows</span> -
                  <strong>Nicolas Grenier</strong> (LISN/Universit√©
                  Paris-Saclay) and <strong>Christian
                    Tenaud</strong> (EM2C/Universit√©
                  Paris-Saclay)</li>
                <li><span>Low-Mach reactive flows</span> - <strong>Christian
                    Tenaud</strong> (EM2C/Universit√©
                  Paris-Saclay)</li>
                <li><span>Interfacial flow simulation</span> - <strong>Giuseppe
                    Orlando</strong> and <strong>Ward Haegeman</strong>
                  (CMAP/Ecole polytechnique), <strong>Jo√´l Dupays</strong> and
                  <strong>Cl√©ment Le Touze</strong> (ONERA), <strong>Marica
                    Pelanti</strong> (ENSTA/IP Paris), <strong>Khaled
                    Saleh</strong> (Universit√© de Lyon), <strong>Jean-Marc
                    H√©rard</strong> (EDF)</li>
                <li><span>Mathematical modeling and simulation of
                    non-equilibrium
                    plasmas for the prediction of electric propulsion</span>
                  -
                  <strong>Zouba√Ør Tazakkati</strong> (CMAP/Ecole
                  polytechnique)</li>
                <li><span>Simulation analysis on the Hydrogen risk</span> -
                  <strong>Luc Lecointre</strong>, <strong>Pierre-Alexandre
                    Masset</strong>, <strong>Etienne Studer</strong> (CEA)
                  and
                  <strong>Christian
                    Tenaud</strong> (EM2C/Universit√©
                  Paris-Saclay)</li>
              </ul>
            </div>
          </div>
        </section>

        <section>
          <div class="sl-block">
            <div class="header">
              <h1 class="title">Roadmap</h1>
            </div>
            <div class="main text-center">
              <img id="adapt" src="/light/figures/roadmap.png">
              <!--
              <ul>
                <li>Implement various finite volume schemes</li>
                <li>Implement various lattice Boltzmann schemes</li>
                <li>Implement various discontinuous Galerkin schemes</li>
                <li>Ponio integration</li>
                <li>Python and Fortran bindings</li>
                <li>Implement point-based multiresolution</li>
              </ul> -->
            </div>
          </div>
        </section>

        <section>
          <div class="sl-block">
            <div class="header">
              <h1 class="title">Roadmap in the NumPeX context</h1>
            </div>
            <div class="main">
              <ul>
                <li>Optimization</li>
                <li>Flexibility in term of container choice</li>
                <li>Parallel backends</li>
                <li>Load balancing using diffusion algorithm or space
                  filling
                  curves</li>
                <li>GPU support</li>
                <li>IO optimization and compression</li>
              </ul>
            </div>
          </div>
        </section>

        <section>
          <div class="row align-items-center">
            <div class="col-4">
              <video data-autoplay loop="true"
                src="/figures/ink.mp4" />
            </div>
            <div class="col">
              <img src="./figures/human.png">
            </div>
            <div class="col-5">
              <img src="./figures/lbm_test_case.png">
            </div>
          </div>
          <div class="row">
            <div class="col-4">
              <video data-autoplay loop="true"
                src="/figures/bubble.mp4" />
            </div>
            <div class="col">
              <img src="./figures/plasma.png">
            </div>
          </div>
        </section>

        <section>
          <div class="sl-block">
            <div class="header">
              <h1 class="title" style="font-size: 30px;">Opening: High-order
                adaptive coupling ONERA /
                CMAP
              </h1>
            </div>
            <div class="main">
              <div class="row align-items-center">
                <div class="col-6">
                  <ul>
                    <li class="my-1" style="font-size: 20px">Easy-to-use,
                      precise, stable coupling strategy</li>
                    <ul class="mx-3 px-0" style="font-size: 14px">
                      <li class="my-1">High-order, polynomial-in-time
                        representations of
                        coupling variables</li>
                      <li class="my-1">Dynamic error estimation to drive
                        $\Delta
                        t$</li>
                      <li class="my-1">Implicit iterative variant for
                        improved
                        stability</li>
                      <li class="my-1">Minimally intrusive</li>
                    </ul>
                    <li class="mt-3 mb-1" style="font-size: 20px">Research
                      project at ONERA + PhD</li>
                    <ul class="mx-3 px-0" style="font-size: 14px">
                      <li class="my-1">Detailed theoretical analysis</li>
                      <li class="my-1">Development of CWIPI 2.0 with time
                        coupling<br>
                        ‚Üíplug-and-play interface for space-time
                        coupling</li>
                      <li class="my-1">Demonstrations :</li>
                      <ul class="mx-3 px-0">
                        <li class="my-1">various applications :
                          fluid-plasma,
                          fluid-structure,
                          heat transfer‚Ä¶</li>
                        <li class="my-1">and codes : CEDRE, SoniCs, Taranis,
                          Zset, Yales2,
                          Modethec, Aghora‚Ä¶</li>
                      </ul>
                      <li class="my-1">Link with NumPEx, CORIA, NASA</li>

                    </ul>
                  </ul>
                </div>
                <div class="col-6 text-center">
                  <div>
                    <img src="./figures/cwipi-2.png">
                  </div>
                  <div>
                    <img width="60%" src="./figures/cwipi_1.png">
                  </div>
                </div>
              </div>
              <div class="mt-3 row text-center" style="font-size: 10px;">
                <p class="my-1">PhD in preparation within the French
                  Exascale
                  program NumPEx - ExaMA (ONERA / CMAP / SafranTech / CORIA)
                  -
                  Antoine Simon</p>
                <p class="my-1">Open-source Python demonstrator Rhapsopy,
                  Really
                  High-order AdaPtive coupling for Simulation Orchestration
                  in
                  PYthon <a
                    href="https://github.com/hpc-maths/Rhapsopy">Github</a></p>
                <p class="my-1">Fran√ßois L. PhD 2022 Multiphysical modelling
                  and
                  simulation of the ignition transient of complete solid
                  rocket
                  motors - <a
                    href="https://theses.hal.science/tel-03670668">https://theses.hal.science/tel-03670668</a></p>
                <p class="my-1">Fran√ßois, L. and Massot, M. (2023) Multistep
                  interface coupling for high-order adaptive black-box
                  multiphysics simulations, 10th Int. Conf. on Comp. Methods
                  for
                  Coupled Problems in Science and Engineering</p>
                <p class="my-1">Asad, A. De Loubens, R., Fran√ßois, L. and
                  Massot, M. (2024), High-order adaptive multi-domain time
                  integration scheme for microscale lithium-ion batteries
                  simulations, Submitted - available on <a
                    href="https://hal.science/hal-04234011v1">Hal</a> and
                  ArXiv.</p>
              </div>
            </div>
          </div>
        </section>

        <section>
          <div class="row">
            <div class="col-6">
              <img src="./figures/logo.png">
            </div>
            <div class="col-6 align-self-center text-end">
              <h1 class="title-talk">Samurai</h1>
              <a
                href="https://github.com/hpc-maths/samurai">https://github.com/hpc-maths/samurai</a>
            </div>
          </div>
        </section>

        <section>
          <div class="sl-block">
            <div class="header">
              <h1 class="title">Back-up slides - ROCK method (PhD Abdulle
                2001)
              </h1>
            </div>
            <div class="main" style="font-size: 20px">
              <div class="row align-items-center">
                <div class="col-6 mr-0">
                  <ul>
                    <li>Large extension of a stability domain on the
                      negative
                      real line (~s2 key idea)</li>
                    <li>Important gain in computational efficiency compared
                      to
                      standard ERK</li>
                    <li>Allows to treat diffusion explicitly (even with very
                      fine meshes) without impairing the time step stability
                      limit</li>
                  </ul>
                </div>
                <div class="col-6 text-center m-0">
                  <div>
                    <img src="./figures/stability_domain_rock_1.png">
                  </div>
                  <div>
                    <img src="./figures/stability_domain_rock_2.png">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
    <script type="module" src="/main.js"></script>

  </body>

</html>
